set -e

mkdir -p ${BOSH_INSTALL_TARGET}/src
cp -a . ${BOSH_INSTALL_TARGET}/src
export GOPATH=$BOSH_INSTALL_TARGET

export GOCACHE=/var/vcap/data/golang-1.13-linux/cache
export GOROOT=$(readlink -nf /var/vcap/packages/golang-1.13-linux)
export PATH=$GOROOT/bin:$PATH
go install code.cloudfoundry.org/nfsbroker

cp code.cloudfoundry.org/nfsbroker/Procfile ${BOSH_INSTALL_TARGET}

# clean up source artifacts
rm -rf ${BOSH_INSTALL_TARGET}/src ${BOSH_INSTALL_TARGET}/pkg